<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Usuario;
use App\Models\Persona; //importando la clase Persona
class usuarioController extends Controller
{
    //para index
    public function index(){
        $usuarios = Usuario::where('estado', 1)->orderBy('id', 'desc')->paginate(2);
        //dd($usuario);
        return view('admin/usuario/index')->with('usuarios', $usuarios);
    }
    //create
     public function create(){
        return view('admin/usuario/create');
     }
    //store
    public function store(Request $request){
        //Primeiro, crea una nueva Persona
        $persona = new Persona();
        $persona->nombre = $request->nombre_persona;
        $persona->apellido = $request->apellido_persona;
        // ... (otros campos pos si acaso)
        $persona->save();

        //Luego, crea un nuevo Usuario que referencia a esa Pesona
        $usuario = new Usuario();
        // Asegúrate de tener una columna persona_id o similar en tu tabla Usuario
        $usuario->persona_id = $persona->id;
        $usuario->email = $request->email;
        $usuario->password = $request->password;
        // ... (otros campos si los hay)
        $usuario->save();
    
        return redirect()->route('usuario.index');
    }
    //edit
    public function edit($id){
        $usuario = Usuario::find($id);
        return view('admin/usuario/edit')->with('usuario', $usuario);
    }
    //update
    public function update(Request $request, $id){
        $usuario = Usuario::find($id);
        $persona = $usuario->persona;
    
        $persona->nombre = $request->nombre_persona;
        $persona->apellido = $request->apellido_persona;
        $persona->save();
        // Ejemplo, puedes agregar o quitar campos según tu necesidad
        $usuario->email = $request->email; 
        // Ejemplo
        $usuario->password = $request->password;  
        $usuario->save();
    
        return redirect()->route('usuario.index');
    }
    //destroy
    public function destroy($id){
        $usuario = Usuario::find($id);
        //dd($usuario);
        $usuario->estado = 0;
        $usuario->save();
        return redirect()->route('usuario.index');
    }
}
